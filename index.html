<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<title>多功能查询与历史名人展示</title>
<style>
  body { font-family: "Microsoft Yahei", sans-serif; max-width: 1000px; margin: 20px auto; }
  header { display: flex; justify-content: space-between; margin-bottom: 20px; }
  #historical-person, #current-news {
    border: 1px solid #ccc; padding: 10px; width: 45%; box-sizing: border-box; border-radius: 8px;
    display: flex; gap: 15px; align-items: center; background: #fafafa;
  }
  #historical-person img, #current-news img {
    width: 120px; height: 120px; object-fit: contain; border-radius: 6px; background: #fff;
  }
  #historical-person div, #current-news div {
    flex: 1;
  }
  h1 { text-align: center; margin-bottom: 30px; }
  button { margin: 5px; padding: 8px 15px; cursor: pointer; }
  #functions { text-align: center; margin-bottom: 40px; }
  #results { white-space: pre-wrap; border: 1px solid #ccc; padding: 15px; border-radius: 8px; max-height: 400px; overflow-y: auto; background: #fff; }
</style>
</head>
<body>

<header>
  <div id="historical-person">
    <img id="person-img" alt="历史人物" src="" />
    <div>
      <h3 id="person-name"></h3>
      <p id="person-desc"></p>
      <a id="person-link" href="#" target="_blank">详细链接</a>
    </div>
  </div>

  <div id="current-news">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/07/News_icon_1.svg/120px-News_icon_1.svg.png" alt="时事" />
    <div>
      <h3>今日时事快报</h3>
      <p>中国和日本正在深化经济合作。</p>
      <a href="https://news.baidu.com" target="_blank">阅读详情</a>
    </div>
  </div>
</header>

<h1>多功能查询平台</h1>
<div id="functions">
  <button onclick="queryWikipedia()">查询维基历史事件</button>
  <button onclick="queryIP()">查询IP信息</button>
  <button onclick="showRandomPerson()">刷新随机历史人物</button>
</div>

<div id="results">结果将在这里显示...</div>

<script>
  let data = null;
  let usedPersons = new Set();

  // 读取JSON数据
  fetch('data/historical_persons.json')
    .then(res => res.json())
    .then(json => {
      data = [...json.modern, ...json.postAncient, ...json.preAncient];
      showRandomPerson();
    })
    .catch(() => {
      document.getElementById('results').textContent = '加载历史人物数据失败。';
    });

  function showRandomPerson() {
    if (!data || data.length === 0) return;
    // 保证不重复显示，重置集合时从头开始
    if (usedPersons.size >= data.length) usedPersons.clear();

    let idx;
    do {
      idx = Math.floor(Math.random() * data.length);
    } while (usedPersons.has(idx));
    usedPersons.add(idx);

    const person = data[idx];
    document.getElementById('person-img').src = person.img || 'https://via.placeholder.com/120x120?text=无图';
    document.getElementById('person-name').textContent = person.name;
    document.getElementById('person-desc').textContent = person.description || '无简介';
    const linkEl = document.getElementById('person-link');
    linkEl.href = person.link;
    linkEl.textContent = '详细链接';
  }

  // 示例维基查询
  function queryWikipedia() {
    const keyword = prompt('请输入要查询的历史事件关键词：');
    if (!keyword) return;
    const url = `https://zh.wikipedia.org/w/api.php?action=query&format=json&list=search&srsearch=${encodeURIComponent(keyword)}&origin=*`;
    fetch(url)
      .then(res => res.json())
      .then(data => {
        const results = data.query.search.map(item => `标题：${item.title}\n摘要：${item.snippet.replace(/<[^>]+>/g, '')}\n`).join('\n');
        document.getElementById('results').textContent = results || '无结果';
      })
      .catch(() => {
        document.getElementById('results').textContent = '查询失败';
      });
  }

  // 示例IP查询
  function queryIP() {
    const ip = prompt('请输入IP地址查询示例（这里只返回演示结果）：');
    if (!ip) return;
    // 这里演示静态返回，实际可改为调用第三方API
    const demo = `IP: ${ip}\n国家：中国\n城市：北京\nISP: 演示网络\n`;
    document.getElementById('results').textContent = demo;
  }
</script>
</body>
</html>
