<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>多功能查询与随机历史人物新闻</title>
<style>
  body {
    font-family: "Microsoft Yahei", Arial, sans-serif;
    margin: 20px;
    background: #f0f2f5;
    color: #333;
  }
  header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 20px;
  }
  #history-person, #current-news {
    width: 48%;
    background: white;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    overflow-wrap: break-word;
  }
  #history-person img, #current-news img {
    max-width: 100%;
    border-radius: 5px;
    margin-bottom: 10px;
    object-fit: contain;
  }
  .title {
    font-weight: bold;
    font-size: 1.3em;
    margin-bottom: 10px;
    color: #1a73e8;
  }
  a {
    color: #1a73e8;
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
  #person-date {
    font-style: italic;
    color: #666;
  }

  main {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
  section.query-section {
    margin-bottom: 30px;
  }
  section.query-section h2 {
    color: #1a73e8;
    margin-bottom: 10px;
  }
  input[type="text"] {
    width: 300px;
    padding: 8px 12px;
    font-size: 1em;
    border: 1px solid #ccc;
    border-radius: 5px;
    margin-right: 10px;
  }
  button {
    padding: 8px 15px;
    font-size: 1em;
    border: none;
    border-radius: 5px;
    background-color: #1a73e8;
    color: white;
    cursor: pointer;
  }
  button:hover {
    background-color: #155ab6;
  }
  #result, #wiki-result, #news-result, #dict-result {
    margin-top: 10px;
    max-width: 900px;
    line-height: 1.5em;
  }
  #result a, #wiki-result a, #news-result a, #dict-result a {
    color: #1a73e8;
  }
  #news-summary {
    white-space: pre-wrap;
  }
</style>
</head>
<body>

<header>
  <div id="history-person" aria-label="历史人物">
    <div class="title">历史人物</div>
    <img id="person-img" src="" alt="历史人物照片" />
    <div><strong id="person-name"></strong> (<span id="person-date"></span>)</div>
    <div><a id="person-link" href="" target="_blank" rel="noopener noreferrer">查看更多</a></div>
  </div>

  <div id="current-news" aria-label="时事新闻">
    <div class="title">时事新闻</div>
    <img id="news-img" src="" alt="新闻图片" />
    <div id="news-summary"></div>
    <div><a id="news-link" href="" target="_blank" rel="noopener noreferrer">阅读详情</a></div>
  </div>
</header>

<main>
  <section class="query-section" id="wiki-section">
    <h2>维基百科历史事件查询</h2>
    <input type="text" id="wiki-input" placeholder="输入关键词，比如“甲午战争”" />
    <button onclick="searchWikipedia()">查询</button>
    <div id="wiki-result"></div>
  </section>

  <section class="query-section" id="news-section">
    <h2>新闻查询</h2>
    <input type="text" id="news-input" placeholder="输入关键词，比如“经济”" />
    <button onclick="searchNews()">查询</button>
    <div id="news-result"></div>
  </section>

  <section class="query-section" id="dict-section">
    <h2>词典查询</h2>
    <input type="text" id="dict-input" placeholder="输入词语，比如“和谐”" />
    <button onclick="searchDict()">查询</button>
    <div id="dict-result"></div>
  </section>
</main>

<script>
  // === 历史人物数据 ===
  const historyPersons = [
    {
      name: "诸葛亮",
      date: "181年 - 234年",
      img: "https://upload.wikimedia.org/wikipedia/commons/7/7d/Zhuge_Liang.jpg",
      link: "https://zh.wikipedia.org/wiki/%E8%AB%B8%E8%91%9B%E4%BA%AE"
    },
    {
      name: "秦始皇",
      date: "259 BC - 210 BC",
      img: "https://upload.wikimedia.org/wikipedia/commons/e/e7/Qin_Shi_Huang.jpg",
      link: "https://zh.wikipedia.org/wiki/%E7%A7%A6%E5%A7%8B%E7%9A%87"
    },
    {
      name: "孙中山",
      date: "1866年 - 1925年",
      img: "https://upload.wikimedia.org/wikipedia/commons/1/11/Sun_Yat-sen_1922.jpg",
      link: "https://zh.wikipedia.org/wiki/%E5%AD%99%E4%B8%AD%E5%B1%B1"
    }
  ];

  // === 时事新闻数据，详细简介 ===
  const currentNews = [
    {
      summary: `2025年6月17日，某地发生重大政治事件：政府宣布实施新的经济改革计划，旨在促进科技创新和绿色能源的发展，计划包括增加财政投入、调整税收政策以及鼓励企业投资绿色项目。这一改革被认为将对国家未来发展产生深远影响，同时引发部分群体的关注和讨论。`,
      img: "https://upload.wikimedia.org/wikipedia/commons/thumb/f/f7/Flag_of_China.svg/320px-Flag_of_China.svg.png",
      link: "https://news.example.com/article1"
    },
    {
      summary: `国际局势紧张，重要会议召开：多个国家代表齐聚联合国总部，讨论当前全球安全形势和气候变化问题。会议重点涉及区域冲突调解、核裁军谈判以及国际合作机制的完善。会议期间，各方表达了不同立场，但整体达成了加强合作的共识。此次会议被视为缓解紧张局势的重要一步。`,
      img: "https://upload.wikimedia.org/wikipedia/commons/thumb/a/a4/Flag_of_the_United_Nations.svg/320px-Flag_of_the_United_Nations.svg.png",
      link: "https://news.example.com/article2"
    }
  ];

  // === 工具函数 ===
  function getTodayKey(base) {
    const today = new Date().toISOString().slice(0,10); // yyyy-mm-dd
    return base + "_" + today;
  }

  function getUsedIndices(key) {
    const json = localStorage.getItem(key);
    return json ? JSON.parse(json) : [];
  }

  function setUsedIndices(key, arr) {
    localStorage.setItem(key, JSON.stringify(arr));
  }

  // 这里实现无限无重复随机索引，全部用完后自动重置
  function getRandomIndexWithoutRepeat(array, usedIndicesKey) {
    let used = getUsedIndices(usedIndicesKey);
    if (used.length >= array.length) {
      // 全部用完，重置
      used = [];
    }
    const available = [];
    for (let i = 0; i < array.length; i++) {
      if (!used.includes(i)) {
        available.push(i);
      }
    }
    if (available.length === 0) return null;
    const idx = available[Math.floor(Math.random() * available.length)];
    used.push(idx);
    setUsedIndices(usedIndicesKey, used);
    return idx;
  }

  function showRandomContentNoRepeat() {
    const personKey = getTodayKey("usedPersons");
    const newsKey = getTodayKey("usedNews");

    const personIdx = getRandomIndexWithoutRepeat(historyPersons, personKey);
    const newsIdx = getRandomIndexWithoutRepeat(currentNews, newsKey);

    const person = historyPersons[personIdx];
    const news = currentNews[newsIdx];

    if (person) {
      document.getElementById("person-img").src = person.img;
      document.getElementById("person-name").textContent = person.name;
      document.getElementById("person-date").textContent = person.date;
      document.getElementById("person-link").href = person.link;
    } else {
      document.getElementById("person-img").src = "";
      document.getElementById("person-name").textContent = "无更多数据";
      document.getElementById("person-date").textContent = "";
      document.getElementById("person-link").href = "#";
    }

    if (news) {
      document.getElementById("news-img").src = news.img;
      document.getElementById("news-summary").textContent = news.summary;
      document.getElementById("news-link").href = news.link;
    } else {
      document.getElementById("news-img").src = "";
      document.getElementById("news-summary").textContent = "无更多新闻";
      document.getElementById("news-link").href = "#";
    }
  }

  // 页面加载时调用
  window.onload = showRandomContentNoRepeat;

  // === 维基百科历史事件查询 ===
  function searchWikipedia() {
    const query = document.getElementById("wiki-input").value.trim();
    const resultDiv = document.getElementById("wiki-result");
    if (!query) {
      resultDiv.innerHTML = "<span style='color:red;'>请输入关键词</span>";
      return;
    }

    const url = `https://zh.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(query)}&format=json&origin=*`;

    fetch(url)
      .then(response => response.json())
      .then(data => {
        const searchResults = data.query.search;
        if (searchResults.length === 0) {
          resultDiv.innerHTML = "无相关结果。";
          return;
        }
        let html = "<ul>";
        searchResults.forEach(item => {
          const title = item.title;
          const snippet = item.snippet.replace(/<\/?[^>]+(>|$)/g, "");
          const link = `https://zh.wikipedia.org/wiki/${encodeURIComponent(title)}`;
          html += `<li><a href="${link}" target="_blank" rel="noopener noreferrer">${title}</a><br/><small>${snippet}...</small></li>`;
        });
        html += "</ul>";
        resultDiv.innerHTML = html;
      })
      .catch(() => {
        resultDiv.innerHTML = "<span style='color:red;'>查询失败，请稍后再试。</span>";
      });
  }

  // === 新闻查询示例 ===
  function searchNews() {
    const keyword = document.getElementById("news-input").value.trim();
    const resultDiv = document.getElementById("news-result");
    if (!keyword) {
      resultDiv.innerHTML = "<span style='color:red;'>请输入关键词</span>";
      return;
    }
    // 示例占位，需替换成真实支持CORS的新闻API
    resultDiv.innerHTML = "新闻查询示例功能，需替换为真实API。";
  }

  // === 词典查询示例 ===
  function searchDict() {
    const word = document.getElementById("dict-input").value.trim();
    const resultDiv = document.getElementById("dict-result");
    if (!word) {
      resultDiv.innerHTML = "<span style='color:red;'>请输入词语</span>";
      return;
    }

    const url = `https://hanyu.baidu.com/s?wd=${encodeURIComponent(word)}`;
    resultDiv.innerHTML = `<a
