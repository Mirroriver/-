<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>雨滴网站-2</title>
  <style>
    body { font-family: "Microsoft Yahei", sans-serif; margin: 0; padding: 0; background: #f0f0f0;}
    header, footer { background: #333; color: #fff; padding: 10px 20px; }
    main { display: flex; padding: 20px; gap: 20px; }
    section { background: #fff; padding: 20px; border-radius: 6px; flex: 1; overflow-y: auto; max-height: 80vh; }
    h2 { border-bottom: 2px solid #ddd; padding-bottom: 5px; }
    img { max-width: 150px; max-height: 150px; margin-right: 10px; vertical-align: middle; border-radius: 4px; }
    .item { margin-bottom: 12px; display: flex; align-items: flex-start; }
    .item-info { flex: 1; }
    .search-box { margin-bottom: 15px; }
    a { color: #0645ad; text-decoration: none; }
    a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <header>
    <h1>历史人物与维基新闻查询</h1>
  </header>

  <main>
    <section id="historical-section">
      <h2>历史人物</h2>
      <input type="text" id="personSearch" placeholder="搜索历史人物" class="search-box" />
      <div id="historical-list"></div>
    </section>

    <section id="news-section">
      <h2>维基今日新闻</h2>
      <div id="news-list"></div>
    </section>
  </main>

  <footer>
    <small>数据来源：维基百科 | 由GitHub Actions自动更新</small>
  </footer>

  <script>
    let historicalData = [];
    let newsData = [];

    async function loadData() {
      try {
        const personsResp = await fetch('data/historical_persons.json');
        historicalData = await personsResp.json();

        const newsResp = await fetch('data/news.json');
        newsData = await newsResp.json();

        displayHistorical(historicalData);
        displayNews(newsData);
      } catch (e) {
        console.error("加载数据失败", e);
        document.getElementById('historical-list').innerText = '加载历史人物失败';
        document.getElementById('news-list').innerText = '加载新闻失败';
      }
    }

    function displayHistorical(data) {
      const container = document.getElementById('historical-list');
      container.innerHTML = '';
      // 合并所有类别数据
      const allPersons = [].concat(data.modern, data.postAncient, data.preAncient);
      allPersons.forEach(p => {
        const div = document.createElement('div');
        div.className = 'item';
        div.innerHTML = `
          ${p.img ? `<img src="${p.img}" alt="${p.name}"/>` : ''}
          <div class="item-info">
            <a href="${p.link}" target="_blank"><strong>${p.name}</strong></a><br/>
            <small>${p.birth || ''} - ${p.death || ''}</small>
            <p>${p.description}</p>
          </div>`;
        container.appendChild(div);
      });
    }

    function displayNews(data) {
      const container = document.getElementById('news-list');
      container.innerHTML = '';
      data.forEach(n => {
        const div = document.createElement('div');
        div.className = 'item';
        div.innerHTML = `
          ${n.img ? `<img src="${n.img}" alt="新闻图"/>` : ''}
          <div class="item-info">
            <a href="${n.link}" target="_blank"><strong>${n.title}</strong></a>
            <p>${n.desc}</p>
          </div>`;
        container.appendChild(div);
      });
    }

    // 搜索功能
    document.getElementById('personSearch').addEventListener('input', e => {
      const keyword = e.target.value.trim().toLowerCase();
      if (!keyword) {
        displayHistorical(historicalData);
        return;
      }
      const filtered = [].concat(historicalData.modern, historicalData.postAncient, historicalData.preAncient)
        .filter(p => p.name.toLowerCase().includes(keyword) || p.description.toLowerCase().includes(keyword));
      displayHistorical({modern: filtered, postAncient: [], preAncient: []});
    });

    window.onload = loadData;
  </script>
</body>
</html>
